<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title id="page-title">Login</title>
    <link rel="stylesheet" href="global.css" />
    <style>
      body {
        margin: 0;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg);
      }

      .card {
        background: var(--main);
        padding: 60px 80px;
        border-radius: 25px;
        display: flex;
        flex-direction: column;
      }

      input {
        min-width: 300px;
        padding: 15px;
        margin: 10px 0;
        border-radius: 20px;
        border: none;
        outline: none;
        font-size: 20px;
        background: var(--input);
        font-family: "Red Hat Mono", monospace;
      }

      button {
        min-width: 300px;
        padding: 15px;
        margin-top: 15px;
        border-radius: 20px;
        border: none;
        font-size: 20px;
        cursor: pointer;
        background: var(--primary-button);
        font-family: "Red Hat Mono", monospace;
        transition: background 0.3s;
      }

      button.invite-mode {
        background: var(--secondary-button);
      }

      button:hover {
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <input
        id="username"
        aria-label="Username"
        type="text"
        placeholder="Username"
      />
      <input
        id="password"
        aria-label="Password"
        type="password"
        placeholder="Password"
      />
      <button id="action-button">Login</button>
    </div>

    <script>
      async function hashPassword(password) {
        const encoder = new TextEncoder();
        const data = encoder.encode(password);
        const hashBuffer = await crypto.subtle.digest("SHA-256", data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
      }

      function updateUI() {
        const button = document.getElementById("action-button");
        const title = document.getElementById("page-title");

        if (window.location.hash === "#invite") {
          button.textContent = "Invite";
          button.classList.add("invite-mode");
          title.textContent = "Invite";
        } else {
          button.textContent = "Login";
          button.classList.remove("invite-mode");
          title.textContent = "Login";
        }
      }
      document
        .getElementById("action-button")
        .addEventListener("click", async () => {
          const userInp = document.getElementById("username");
          const passInp = document.getElementById("password");

          const username = userInp.value;
          const password = passInp.value;

          if (!username || !password) {
            alert("Fill in the fields!");
            return;
          }

          const hashedPassword = await hashPassword(password);

          if (window.location.hash === "#invite") {
            const userData = {
              user: username,
              pass: hashedPassword,
            };
            localStorage.setItem("storedUser", JSON.stringify(userData));
            alert("Successful registration");
            window.location.hash = "";
          } else {
            const rawData = localStorage.getItem("storedUser");

            const storedData = JSON.parse(rawData);
            if (
              storedData.user === username &&
              storedData.pass === hashedPassword
            ) {
              window.location.href = "dashboard.html";
            } else {
              alert("Incorrect username or password!");
            }
          }
        });

      window.addEventListener("load", updateUI);
      window.addEventListener("hashchange", updateUI);
    </script>
  </body>
</html>
